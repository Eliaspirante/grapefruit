<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\entity\Entity.js - gf</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="gf"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Clock.html">Clock</a></li>
            
                <li><a href="..&#x2F;classes/game.html">game</a></li>
            
                <li><a href="..&#x2F;classes/Sprite.html">Sprite</a></li>
            
                <li><a href="..&#x2F;classes/support.html">support</a></li>
            
                <li><a href="..&#x2F;classes/types.html">types</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/gf.html">gf</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\entity\Entity.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function() {
    &#x2F;&#x2F;Features TODO:
    &#x2F;&#x2F; * Methods (https:&#x2F;&#x2F;github.com&#x2F;obiot&#x2F;melonJS&#x2F;blob&#x2F;master&#x2F;src&#x2F;entity&#x2F;entity.js)
    &#x2F;&#x2F;      - flipX
    &#x2F;&#x2F;      - flipY
    &#x2F;&#x2F;      - doWalk
    &#x2F;&#x2F;      - doClimb
    &#x2F;&#x2F;      - doJump
    &#x2F;&#x2F;      - forceJump
    &#x2F;&#x2F;      - checkSlope
    &#x2F;&#x2F;      - updateMovement (slopes&#x2F;breakable tiles)
    gf.Entity = gf.Sprite.extend({
        &#x2F;&#x2F;initializes a new entity with the start position (pos)
        &#x2F;&#x2F;and properties (settings). Many of these properties can
        &#x2F;&#x2F;be specified in Tiled.
        init: function(pos, settings) {
            &#x2F;****************************************************************************
             * Properties that are defined in the &#x60;settings&#x60; object,
             * these can be specified in the properties of the object layer
             * in Tiled, and overriden on a per-object basis
             ****************************************************************************&#x2F;
            this.type = gf.types.ENTITY.NEUTRAL;

            &#x2F;&#x2F;can collide with other entities
            this.collidable = true;

            &#x2F;&#x2F;can collide with the map when moving
            this.mapCollidable = true;

            &#x2F;&#x2F;is an entity
            this.entity = true;

            &#x2F;&#x2F;you can still set these in Tiled by using &quot;x|y&quot; notation
            &#x2F;&#x2F;velocity of the entity (units per tick)
            this.velocity = new gf.Vector(0, 0);

            &#x2F;&#x2F;max velocity to cap the entity at (units per tick)
            this.maxVelocity = new gf.Vector(15, 15);

            &#x2F;&#x2F;acceleration of the entity when moving (units per second)
            this.accel = new gf.Vector(250, 250);

            &#x2F;&#x2F;size of the hitbox
            this.hitSize = new gf.Vector(0, 0);

            &#x2F;&#x2F;offset from the center to have the hitbox
            this.hitOffset = new gf.Vector(0, 0);

            &#x2F;&#x2F;friction to apply to this entities movement
            this.friction = settings.friction || gf.game.friction;

            &#x2F;&#x2F;gravity to apply to this entities movement
            this.gravity = settings.gravity || gf.game.gravity;

            &#x2F;&#x2F;entity alive
            this.alive = true;

            &#x2F;&#x2F;entity falling (read only)
            this.falling = false;

            &#x2F;&#x2F;entity jumping (read only)
            this.jumping = false;

            &#x2F;&#x2F;entity on a ladder (read only)
            this.onladder = false;

            &#x2F;****************************************************************************
             * Call base constructor
             ****************************************************************************&#x2F;
            this._super(pos, settings);
        },
        &#x2F;&#x2F;calculates distance between this object and another
        distanceTo: function(obj) {
            if(!obj || !obj.position)
                return -1;

            var dx = this.position.x - obj.position.x,
                dy = this.position.y - obj.position.y;

            return Math.sqrt(dx*dx + dy*dy);
        },
        &#x2F;&#x2F;computes the velocity taking into account gravity, friction, etc
        computeVelocity: function(vel) {
            &#x2F;&#x2F;apply gravity
            if(this.gravity) {
                vel.y -= !this.onladder ? (this.gravity * gf.game._delta) : 0;

                &#x2F;&#x2F;check if falling&#x2F;jumping
                this.falling = (vel.y &lt; 0);
                this.jumping = this.falling ? false : this.jumping;
            }

            &#x2F;&#x2F;apply friction
            if(this.friction.x) vel.x = gf.utils.applyFriction(vel.x, this.friction.x);
            if(this.friction.y) vel.y = gf.utils.applyFriction(vel.y, this.friction.y);

            &#x2F;&#x2F;cap velocity
            if(vel.x) vel.x = gf.utils.clamp(vel.x, -this.maxVelocity.x, this.maxVelocity.x);
            if(vel.y) vel.y = gf.utils.clamp(vel.y, -this.maxVelocity.y, this.maxVelocity.y);

            return this;
        },
        &#x2F;&#x2F;from http:&#x2F;&#x2F;gamedev.stackexchange.com&#x2F;questions&#x2F;586&#x2F;what-is-the-fastest-way-to-work-out-2d-bounding-box-intersection
        intersects: function(obj)  {
            return (Math.abs(this.position.x - obj.position.x) * 2 &lt; (this.size.x + obj.size.x)) &amp;&amp; 
                    (Math.abs(this.position.y - obj.position.y) * 2 &lt; (this.size.y + obj.size.y));
        },
        checkCollision: function(obj) {
            &#x2F;&#x2F;response vector
            var p = new gf.Vector(0, 0);

            &#x2F;&#x2F;check if hitboxes intersect
            if(this.intersects(obj)) {
                &#x2F;&#x2F;compute delta between this &amp; entity
                var dx = this.position.x - obj.position.x,
                    dy = this.position.y - obj.position.y;

                &#x2F;&#x2F;compute penetration depth for both axis
                p.x = dx &#x2F; 2;
                p.y = dy &#x2F; 2;
            }

            return p;
        },
        updateMovement: function() {
            if(this.velocity.x === 0 &amp;&amp; this.velocity.y === 0)
                return;

            &#x2F;&#x2F;get the world colliders
            var colliders = (gf.game.world === undefined || !this.mapCollidable) ? [] : gf.game.world.checkCollision(this);

            &#x2F;&#x2F;update flags
            this.onladder = false;

            &#x2F;&#x2F;collisions
            for(var i = 0, il = colliders.length; i &lt; il; ++i) {
                var collider = colliders[i],
                    tile = collider.tile,
                    axis = collider.axis;

                this.onladder = (tile.type == gf.types.COLLISION.LADDER ? true : this.onladder);

                &#x2F;&#x2F;if a solid tile
                if(tile.type == gf.types.COLLISION.SOLID) {
                    &#x2F;&#x2F;if it is a slope, apply the normal
                    if(tile.normal &amp;&amp; (!this.velocity.x || !this.velocity.y)) {
                        var badMovement = tile.normal.clone().multiplyScalar(this.velocity.dot(tile.normal)),
                            newMovement = this.velocity.clone().sub(badMovement);

                        this.velocity.add(newMovement);
                        return false;
                    }
                    &#x2F;&#x2F;otherwise just stop movement
                    else {
                        this.velocity[axis] = 0;
                    }
                }
            }

            &#x2F;&#x2F;TODO: Edge rolling (if you are on the tip edge of a blocking tile, roll around it)

            &#x2F;&#x2F;apply gravity, friction, etc to this velocity
            this.computeVelocity(this.velocity);

            &#x2F;&#x2F;do the actual entity movement
            this.moveEntity();

            &#x2F;&#x2F;for debug output if it is enabled
            gf.debug._playerColliders = colliders;
            gf.debug._playerColliders.dirty = true;

            return colliders;
        },
        moveEntity: function(vel) {
            &#x2F;&#x2F;param will override the entities current velocity
            vel = vel || this.velocity;

            if(vel.x === 0 &amp;&amp; vel.y === 0)
                return;

            &#x2F;&#x2F;update the entity position
            this.position.x += vel.x;
            this.position.y += vel.y;

            &#x2F;&#x2F;onMove event
            this.onMove(vel);

            return this;
        },
        &#x2F;&#x2F;On Collision Event
        &#x2F;&#x2F; called when this object is collided into by another, by default if something collides with
        &#x2F;&#x2F; a collectable entity we remove the collectable
        &#x2F;&#x2F;vec - Collision Vector (gf.Vector)
        &#x2F;&#x2F;obj - Colliding object (gf.Entity)
        onCollision: function(vec, obj) {
            if(this.collidable &amp;&amp; this.type == gf.types.ENTIY.COLLECTABLE)
                gf.game.removeObject(this);

            return this;
        },
        &#x2F;&#x2F;On Move Event
        &#x2F;&#x2F; called when this entity moves
        &#x2F;&#x2F;vel - Velocity the entity moved (gf.Vector)
        onMove: function(vel) {
            return this;
        },
        &#x2F;&#x2F;On Break Tile Event
        &#x2F;&#x2F; called when a tile is broken
        &#x2F;&#x2F;tile - the tile that is broken
        onBreakTile: function(tile) {
            return this;
        }
    });
})();
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
