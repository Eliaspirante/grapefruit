<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\audio\AudioManager.js - gf</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="gf"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/AnimatedSprite.html">AnimatedSprite</a></li>
            
                <li><a href="..&#x2F;classes/AssetLoader.html">AssetLoader</a></li>
            
                <li><a href="..&#x2F;classes/AudioLoader.html">AudioLoader</a></li>
            
                <li><a href="..&#x2F;classes/AudioManager.html">AudioManager</a></li>
            
                <li><a href="..&#x2F;classes/AudoPlayer.html">AudoPlayer</a></li>
            
                <li><a href="..&#x2F;classes/Camera.html">Camera</a></li>
            
                <li><a href="..&#x2F;classes/Circle.html">Circle</a></li>
            
                <li><a href="..&#x2F;classes/Clock.html">Clock</a></li>
            
                <li><a href="..&#x2F;classes/DisplayObjectContainer.html">DisplayObjectContainer</a></li>
            
                <li><a href="..&#x2F;classes/Ellipse.html">Ellipse</a></li>
            
                <li><a href="..&#x2F;classes/Emitter.html">Emitter</a></li>
            
                <li><a href="..&#x2F;classes/Game.html">Game</a></li>
            
                <li><a href="..&#x2F;classes/GameState.html">GameState</a></li>
            
                <li><a href="..&#x2F;classes/Gui.html">Gui</a></li>
            
                <li><a href="..&#x2F;classes/GuiItem.html">GuiItem</a></li>
            
                <li><a href="..&#x2F;classes/ImageLayer.html">ImageLayer</a></li>
            
                <li><a href="..&#x2F;classes/Input.html">Input</a></li>
            
                <li><a href="..&#x2F;classes/JsonLoader.html">JsonLoader</a></li>
            
                <li><a href="..&#x2F;classes/Layer.html">Layer</a></li>
            
                <li><a href="..&#x2F;classes/Loader.html">Loader</a></li>
            
                <li><a href="..&#x2F;classes/Map.html">Map</a></li>
            
                <li><a href="..&#x2F;classes/math.html">math</a></li>
            
                <li><a href="..&#x2F;classes/plugin.html">plugin</a></li>
            
                <li><a href="..&#x2F;classes/Point.html">Point</a></li>
            
                <li><a href="..&#x2F;classes/Polygon.html">Polygon</a></li>
            
                <li><a href="..&#x2F;classes/Rectangle.html">Rectangle</a></li>
            
                <li><a href="..&#x2F;classes/Sprite.html">Sprite</a></li>
            
                <li><a href="..&#x2F;classes/SpritePool.html">SpritePool</a></li>
            
                <li><a href="..&#x2F;classes/support.html">support</a></li>
            
                <li><a href="..&#x2F;classes/Texture.html">Texture</a></li>
            
                <li><a href="..&#x2F;classes/TextureLoader.html">TextureLoader</a></li>
            
                <li><a href="..&#x2F;classes/Tile.html">Tile</a></li>
            
                <li><a href="..&#x2F;classes/TiledLayer.html">TiledLayer</a></li>
            
                <li><a href="..&#x2F;classes/TiledMap.html">TiledMap</a></li>
            
                <li><a href="..&#x2F;classes/TiledObjectGroup.html">TiledObjectGroup</a></li>
            
                <li><a href="..&#x2F;classes/TiledTileset.html">TiledTileset</a></li>
            
                <li><a href="..&#x2F;classes/utils.html">utils</a></li>
            
                <li><a href="..&#x2F;classes/Vector.html">Vector</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\audio\AudioManager.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
gf.__AudioCtx = window.AudioContext || window.webkitAudioContext || window.mozAudioContext;
gf.__audioctx = gf.support.webAudio ? new gf.__AudioCtx() : null;

&#x2F;**
 * Grapefruit Audio API, provides an easy interface to use HTML5 Audio
 * The GF Audio API was based on
 * &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;goldfire&#x2F;howler.js&quot;&gt;Howler.js&lt;&#x2F;a&gt;
 *
 * @class AudioManager
 * @constructor
 *&#x2F;
gf.AudioManager = function() {
    &#x2F;**
     * Whether the player is muted or not
     *
     * @property muted
     * @type Boolean
     * @default false
     * @private
     *&#x2F;
    this._muted = false;

    &#x2F;**
     * The master volume of the player
     *
     * @property _volume
     * @type Number
     * @default 1
     * @private
     *&#x2F;
    this._volume = 1;

    &#x2F;**
     * The Web Audio API context if we are using it
     *
     * @property ctx
     * @type AudioContext
     * @readOnly
     *&#x2F;
    this.ctx = gf.__audioctx;

    &#x2F;**
     * If we have some way of playing audio
     *
     * @property canPlay
     * @type Boolean
     * @readOnly
     *&#x2F;
    this.canPlay = gf.support.webAudio || gf.support.htmlAudio;

    &#x2F;**
     * The codecs that the browser supports
     *
     * @property codecs
     * @type Object&lt;Boolean&gt;
     * @readOnly
     *&#x2F;
    if(this.canPlay) {
        var audioTest = new Audio();

        this.codecs = {
            mp3: !!audioTest.canPlayType(&#x27;audio&#x2F;mpeg;&#x27;).replace(&#x2F;^no$&#x2F;,&#x27;&#x27;),
            opus: !!audioTest.canPlayType(&#x27;audio&#x2F;ogg; codecs=&quot;opus&quot;&#x27;).replace(&#x2F;^no$&#x2F;,&#x27;&#x27;),
            ogg: !!audioTest.canPlayType(&#x27;audio&#x2F;ogg; codecs=&quot;vorbis&quot;&#x27;).replace(&#x2F;^no$&#x2F;,&#x27;&#x27;),
            wav: !!audioTest.canPlayType(&#x27;audio&#x2F;wav; codecs=&quot;1&quot;&#x27;).replace(&#x2F;^no$&#x2F;,&#x27;&#x27;),
            m4a: !!(audioTest.canPlayType(&#x27;audio&#x2F;x-m4a;&#x27;) || audioTest.canPlayType(&#x27;audio&#x2F;aac;&#x27;)).replace(&#x2F;^no$&#x2F;,&#x27;&#x27;),
            webm: !!audioTest.canPlayType(&#x27;audio&#x2F;webm; codecs=&quot;vorbis&quot;&#x27;).replace(&#x2F;^no$&#x2F;,&#x27;&#x27;)
        };
    }

    &#x2F;&#x2F;if we are using web audio, we need a master gain node
    if(gf.support.webAudio) {
        this.masterGain = this.ctx.createGain ? this.ctx.createGainNode() : this.ctx.createGain();
        this.masterGain.gain.value = 1;
        this.masterGain.connect(this.ctx.destination);
    }

    &#x2F;&#x2F;map of elements to play audio with
    this.sounds = {};

    &#x2F;&#x2F;define volume getter&#x2F;setter
    Object.defineProperty(this, &#x27;volume&#x27;, {
        get: this.getVolume.bind(this),
        set: this.setVolume.bind(this)
    });
};

gf.inherits(gf.AudioManager, Object, {
    getVolume: function() {
        return this._volume;
    },
    setVolume: function(v) {
        v = parseFloat(v, 10);

        if(!isNaN(v) &amp;&amp; v &gt;= 0 &amp;&amp; v &lt;= 1) {
            this._volume = v;

            if(gf.support.webAudio)
                this.masterGain.gain.value = v;

            &#x2F;&#x2F;go through each audio element and change their volume
            for(var key in this.sounds) {
                if(this.sounds.hasOwnProperty(key) &amp;&amp; this.sounds[key]._webAudio === false) {
                    var player = this.sounds[key];
                    &#x2F;&#x2F;loop through the audio nodes
                    for(var i = 0, il = player._nodes.length; i &lt; il; ++i) {
                        player._nodes[i].volume = player._volume * this._volume;
                    }
                }
            }
        }
    },
    mute: function() {
        return this.setMuted(true);
    },
    unmute: function() {
        return this.setMuted(false);
    },
    setMuted: function(m) {
        this._muted = m = !!m;

        if(gf.support.webAudio)
            this.masterGain.gain.value = m ? 0 : this._volume;

        &#x2F;&#x2F;go through each audio element and mute&#x2F;unmute them
        for(var key in this.sounds) {
            if(this.sounds.hasOwnProperty(key) &amp;&amp; this.sounds[key]._webAudio === false) {
                var player = this.sounds[key];
                &#x2F;&#x2F;loop through the audio nodes
                for(var i = 0, il = player._nodes.length; i &lt; il; ++i) {
                    player._nodes[i].muted = m;
                }
            }
        }

        return this;
    },
    create: function(name, settings) {
        &#x2F;&#x2F;if we can&#x27;t play audio return false
        if(!this.canPlay) {
            return false;
        }

        &#x2F;&#x2F;name is &quot;optional&quot;
        if(typeof name !== &#x27;string&#x27;) {
            settings = name;
            name = null;
        }

        &#x2F;&#x2F;make up an ID if none was passed
        if(!name)
            name = Math.round(Date.now() * Math.random()) + &#x27;&#x27;;

        var src;

        &#x2F;&#x2F;loop through each source url and pick the first that is compatible
        for(var i = 0, il = settings.urls.length; i &lt; il; ++i) {
            var url = settings.urls[i].toLowerCase(),
                ext;

            &#x2F;&#x2F;if they pass a format override, use that
            if(settings.format) {
                ext = settings.format;
            }
            &#x2F;&#x2F;otherwise extract the format from the url
            else {
                ext = url.match(&#x2F;.+\.([^?]+)(\?|$)&#x2F;);
                ext = (ext &amp;&amp; ext.length &gt;= 2) ? ext[1] : url.match(&#x2F;data\:audio\&#x2F;([^?]+);&#x2F;)[1];
            }

            &#x2F;&#x2F;if we can play this url, then set the source of the player
            if(this.codecs[ext]) {
                src = url;
                break;
            }
        }

        &#x2F;&#x2F;check if we found a usable url, if not return false
        if(!src) {
            return false;
        }

        &#x2F;&#x2F;check if we already created a player for this audio
        if(gf.assetCache[src])
            return gf.assetCache[src];

        settings.src = src;
        return this.sounds[name] = gf.assetCache[src] = new gf.AudioPlayer(this, settings);
    }
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
